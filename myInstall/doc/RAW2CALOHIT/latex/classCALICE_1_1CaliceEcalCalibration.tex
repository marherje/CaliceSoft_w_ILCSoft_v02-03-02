\section{C\-A\-L\-I\-C\-E\-:\-:Calice\-Ecal\-Calibration Class Reference}
\label{classCALICE_1_1CaliceEcalCalibration}\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}


\doxyref{Calibration}{p.}{classCalibration} of the Calice E\-C\-A\-L modules.  




{\ttfamily \#include $<$Calice\-Ecal\-Calibration.\-hh$>$}

Inheritance diagram for C\-A\-L\-I\-C\-E\-:\-:Calice\-Ecal\-Calibration\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classCALICE_1_1CaliceEcalCalibration}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf noexcept} (false)
\begin{DoxyCompactList}\small\item\em Create the calibration object for the Calice Ecal. \end{DoxyCompactList}\item 
{\bf $\sim$\-Calice\-Ecal\-Calibration} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
Float\-\_\-t {\bf get\-Calibrated\-Value} (U\-Int\-\_\-t module\-\_\-id, U\-Int\-\_\-t module\-\_\-type, U\-Int\-\_\-t cell\-\_\-index, Float\-\_\-t adc\-\_\-value) const 
\begin{DoxyCompactList}\small\item\em Determine from a pedestal subtracted A\-D\-C value a calibrated value. \end{DoxyCompactList}\item 
Bool\-\_\-t {\bf is\-Valid} (U\-Int\-\_\-t module\-\_\-id, U\-Int\-\_\-t module\-\_\-type, U\-Int\-\_\-t cell\-\_\-index) const 
\begin{DoxyCompactList}\small\item\em Return true if a the calibration constants for the given cell are in the allowed range. \end{DoxyCompactList}\item 
Bool\-\_\-t {\bf check\-For\-Calibration\-Constants\-Of\-Module} (U\-Int\-\_\-t module\-\_\-id, U\-Int\-\_\-t module\-\_\-type, U\-Int\-\_\-t n\-\_\-cells) const 
\begin{DoxyCompactList}\small\item\em Verify that calibration constants exist for a certain module. \end{DoxyCompactList}\item 
Int\-\_\-t {\bf get\-Minium\-A\-D\-C\-For\-Mip\-Threshold} (Float\-\_\-t mip\-\_\-energy\-\_\-fraction) const 
\begin{DoxyCompactList}\small\item\em Get the minimum adc value mips will have for the given energy fraction on all pads. \end{DoxyCompactList}\item 
void {\bf module\-Type\-Changed} (lcio\-::\-L\-C\-Collection $\ast$col)
\begin{DoxyCompactList}\small\item\em Notify the calibration object in case the definition of the module types has changed. \end{DoxyCompactList}\item 
void {\bf calibration\-Constant\-Changed} (lcio\-::\-L\-C\-Collection $\ast$col)
\begin{DoxyCompactList}\small\item\em Notify the calibration object when ever the calibration constants change. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Types}
\begin{DoxyCompactItemize}
\item 
typedef std\-::vector\\*
$<$ Ecal\-Module\-Calibration $>$ {\bfseries Module\-Type\-Calibration\-Constant\-List\-\_\-t}\label{classCALICE_1_1CaliceEcalCalibration_a7c5d9af5b11b804071982e5292422646}

\item 
typedef std\-::vector$<$ std\-::pair\\*
$<$ const \\*
Module\-Type\-Calibration\-Constant\-List\-\_\-t \\*
$\ast$, std\-::string $>$ $>$ {\bfseries Calibration\-Constant\-Per\-Type\-List\-\_\-t}\label{classCALICE_1_1CaliceEcalCalibration_aab75d417a8477f123384473c932b1d3e}

\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\-::map$<$ std\-::string, \\*
Module\-Type\-Calibration\-Constant\-List\-\_\-t $>$ {\bfseries \-\_\-calibration\-Constants}\label{classCALICE_1_1CaliceEcalCalibration_a3a4ba7bfc9da0dcae8acc075f74eff24}

\item 
Calibration\-Constant\-Per\-Type\-List\-\_\-t {\bf \-\_\-calibration\-Constants\-Per\-Type}
\begin{DoxyCompactList}\small\item\em \doxyref{Calibration}{p.}{classCalibration} constatns per Module. \end{DoxyCompactList}\item 
Conditions\-Change\-Delegator\\*
$<$ {\bf Calice\-Ecal\-Calibration} $>$ {\bfseries \-\_\-module\-Type\-Change}\label{classCALICE_1_1CaliceEcalCalibration_a49a0c1cccc53314ec3e8e44a7186031d}

\item 
Conditions\-Change\-Delegator\\*
$<$ {\bf Calice\-Ecal\-Calibration} $>$ {\bfseries \-\_\-calibration\-Constant\-Change}\label{classCALICE_1_1CaliceEcalCalibration_a3c8999e65ff7276c3acdeb7b19eeea0c}

\item 
Float\-\_\-t {\bfseries \-\_\-min\-Inv\-Calibration\-Constant}\label{classCALICE_1_1CaliceEcalCalibration_ac9690f336fa6c193427f12d4504ad6b4}

\end{DoxyCompactItemize}
\subsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
static Ecal\-Module\-Calibration {\bf \-\_\-empty}
\begin{DoxyCompactList}\small\item\em Used to initialise the vector. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
\doxyref{Calibration}{p.}{classCalibration} of the Calice E\-C\-A\-L modules. 

Definition at line 18 of file Calice\-Ecal\-Calibration.\-hh.



\subsection{Constructor \& Destructor Documentation}
\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!$\sim$\-Calice\-Ecal\-Calibration@{$\sim$\-Calice\-Ecal\-Calibration}}
\index{$\sim$\-Calice\-Ecal\-Calibration@{$\sim$\-Calice\-Ecal\-Calibration}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{$\sim$\-Calice\-Ecal\-Calibration}]{\setlength{\rightskip}{0pt plus 5cm}C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::$\sim$\-Calice\-Ecal\-Calibration (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classCALICE_1_1CaliceEcalCalibration_a90c221567561015797ff5c1b035dda71}


Destructor. 

F\-I\-X\-M\-E\-: The destructor should deregister the conditions change handler. Unfortuneatly, this is not forseen in the Conditions Processor. 

Definition at line 32 of file Calice\-Ecal\-Calibration.\-hh.



\subsection{Member Function Documentation}
\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!calibration\-Constant\-Changed@{calibration\-Constant\-Changed}}
\index{calibration\-Constant\-Changed@{calibration\-Constant\-Changed}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{calibration\-Constant\-Changed}]{\setlength{\rightskip}{0pt plus 5cm}void C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::calibration\-Constant\-Changed (
\begin{DoxyParamCaption}
\item[{lcio\-::\-L\-C\-Collection $\ast$}]{col}
\end{DoxyParamCaption}
)}\label{classCALICE_1_1CaliceEcalCalibration_a0a82a3215a4e35f444904cb80cea3f46}


Notify the calibration object when ever the calibration constants change. 

This function must be called at least once before \doxyref{get\-Calibrated\-Value()}{p.}{classCALICE_1_1CaliceEcalCalibration_a4ffba5606c463a2b7419e85bc9008853} is used. 

Definition at line 121 of file Calice\-Ecal\-Calibration.\-cc.



References \-\_\-calibration\-Constants\-Per\-Type, and \-\_\-empty.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!check\-For\-Calibration\-Constants\-Of\-Module@{check\-For\-Calibration\-Constants\-Of\-Module}}
\index{check\-For\-Calibration\-Constants\-Of\-Module@{check\-For\-Calibration\-Constants\-Of\-Module}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{check\-For\-Calibration\-Constants\-Of\-Module}]{\setlength{\rightskip}{0pt plus 5cm}Bool\-\_\-t C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::check\-For\-Calibration\-Constants\-Of\-Module (
\begin{DoxyParamCaption}
\item[{U\-Int\-\_\-t}]{module\-\_\-id, }
\item[{U\-Int\-\_\-t}]{module\-\_\-type, }
\item[{U\-Int\-\_\-t}]{n\-\_\-cells}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classCALICE_1_1CaliceEcalCalibration_ae6cb1b990f7c4eb7dc274089df464772}


Verify that calibration constants exist for a certain module. 


\begin{DoxyParams}{Parameters}
{\em module\-\_\-id} & id Or serial number of a module which uniquely identifies a detector module of a certain type. \\
\hline
{\em module\-\_\-type} & the type of the detector module \\
\hline
{\em n\-\_\-cells} & the number of cells on this module. Return true if calibration constants exist for the given module and the number of cells matches the number of calibration constants. \\
\hline
\end{DoxyParams}


Definition at line 99 of file Calice\-Ecal\-Calibration.\-hh.



References \-\_\-calibration\-Constants\-Per\-Type.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!get\-Calibrated\-Value@{get\-Calibrated\-Value}}
\index{get\-Calibrated\-Value@{get\-Calibrated\-Value}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{get\-Calibrated\-Value}]{\setlength{\rightskip}{0pt plus 5cm}Float\-\_\-t C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::get\-Calibrated\-Value (
\begin{DoxyParamCaption}
\item[{U\-Int\-\_\-t}]{module\-\_\-id, }
\item[{U\-Int\-\_\-t}]{module\-\_\-type, }
\item[{U\-Int\-\_\-t}]{cell\-\_\-index, }
\item[{Float\-\_\-t}]{adc\-\_\-value}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classCALICE_1_1CaliceEcalCalibration_a4ffba5606c463a2b7419e85bc9008853}


Determine from a pedestal subtracted A\-D\-C value a calibrated value. 


\begin{DoxyParams}{Parameters}
{\em module\-\_\-id} & id Or serial number of a module which uniquely identifies a detector module of a certain type. \\
\hline
{\em module\-\_\-type} & the type of the detector module \\
\hline
{\em cell\-\_\-index} & the cell\-\_\-index in read order\-: first the A\-D\-C values of the first sample from all chips, then the next sample ... \\
\hline
{\em adc\-\_\-value} & the A\-D\-C value which should be calibrated. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the calibrated value. 
\end{DoxyReturn}


Definition at line 42 of file Calice\-Ecal\-Calibration.\-hh.



References \-\_\-calibration\-Constants\-Per\-Type.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!get\-Minium\-A\-D\-C\-For\-Mip\-Threshold@{get\-Minium\-A\-D\-C\-For\-Mip\-Threshold}}
\index{get\-Minium\-A\-D\-C\-For\-Mip\-Threshold@{get\-Minium\-A\-D\-C\-For\-Mip\-Threshold}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{get\-Minium\-A\-D\-C\-For\-Mip\-Threshold}]{\setlength{\rightskip}{0pt plus 5cm}Int\-\_\-t C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::get\-Minium\-A\-D\-C\-For\-Mip\-Threshold (
\begin{DoxyParamCaption}
\item[{Float\-\_\-t}]{mip\-\_\-energy\-\_\-fraction}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classCALICE_1_1CaliceEcalCalibration_af23ff60b95893d5ab5c09132c678805d}


Get the minimum adc value mips will have for the given energy fraction on all pads. 


\begin{DoxyParams}{Parameters}
{\em mip\-\_\-energy\-\_\-fraction} & the energy in mips \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
minimum adc value which is below the given energy on all pads. This method can be used to get the lowest adc value a mip of the given energy fraction will have on all pads. This value is useful to select candidates before actually performing th calibration. This function is intended to be called at the beginning of each event. 
\end{DoxyReturn}


Definition at line 114 of file Calice\-Ecal\-Calibration.\-hh.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!is\-Valid@{is\-Valid}}
\index{is\-Valid@{is\-Valid}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{is\-Valid}]{\setlength{\rightskip}{0pt plus 5cm}Bool\-\_\-t C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::is\-Valid (
\begin{DoxyParamCaption}
\item[{U\-Int\-\_\-t}]{module\-\_\-id, }
\item[{U\-Int\-\_\-t}]{module\-\_\-type, }
\item[{U\-Int\-\_\-t}]{cell\-\_\-index}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classCALICE_1_1CaliceEcalCalibration_a15dc169487e5d13c4da34f56387f2218}


Return true if a the calibration constants for the given cell are in the allowed range. 


\begin{DoxyParams}{Parameters}
{\em module\-\_\-id} & id Or serial number of a module which uniquely identifies a detector module of a certain type. \\
\hline
{\em module\-\_\-type} & the type of the detector module \\
\hline
{\em cell\-\_\-index} & the cell\-\_\-index in read order\-: first the A\-D\-C values of the first sample from all chips, then the next sample ... \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true for cells with valid calibration constants, false for cells which should be declared dead.
\end{DoxyReturn}
This method is used to find, after module connection changes, cells which should be declared dead. 

Definition at line 68 of file Calice\-Ecal\-Calibration.\-hh.



References \-\_\-calibration\-Constants\-Per\-Type.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!module\-Type\-Changed@{module\-Type\-Changed}}
\index{module\-Type\-Changed@{module\-Type\-Changed}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{module\-Type\-Changed}]{\setlength{\rightskip}{0pt plus 5cm}void C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::module\-Type\-Changed (
\begin{DoxyParamCaption}
\item[{lcio\-::\-L\-C\-Collection $\ast$}]{col}
\end{DoxyParamCaption}
)}\label{classCALICE_1_1CaliceEcalCalibration_ab29f2d5fdc65d38388ca8d3a57f3a419}


Notify the calibration object in case the definition of the module types has changed. 

This function must be called at least once before \doxyref{get\-Calibrated\-Value()}{p.}{classCALICE_1_1CaliceEcalCalibration_a4ffba5606c463a2b7419e85bc9008853} is used. 

Definition at line 79 of file Calice\-Ecal\-Calibration.\-cc.



References \-\_\-calibration\-Constants\-Per\-Type.

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!noexcept@{noexcept}}
\index{noexcept@{noexcept}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{noexcept}]{\setlength{\rightskip}{0pt plus 5cm}C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::noexcept (
\begin{DoxyParamCaption}
\item[{false}]{}
\end{DoxyParamCaption}
)}\label{classCALICE_1_1CaliceEcalCalibration_a649e0aadc09a6d76235dfc4fe9ff7dc1}


Create the calibration object for the Calice Ecal. 

The constructor will register handlers for conditions data changes\-: changes of the module types and the calibration constants. 

\subsection{Field Documentation}
\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!\-\_\-calibration\-Constants\-Per\-Type@{\-\_\-calibration\-Constants\-Per\-Type}}
\index{\-\_\-calibration\-Constants\-Per\-Type@{\-\_\-calibration\-Constants\-Per\-Type}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{\-\_\-calibration\-Constants\-Per\-Type}]{\setlength{\rightskip}{0pt plus 5cm}Calibration\-Constant\-Per\-Type\-List\-\_\-t C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::\-\_\-calibration\-Constants\-Per\-Type\hspace{0.3cm}{\ttfamily [private]}}\label{classCALICE_1_1CaliceEcalCalibration_ae5dc90ad764f76fc60628267eb5e5504}


\doxyref{Calibration}{p.}{classCalibration} constatns per Module. 

The first array component is the module type, the second the serial number of the module. 

Definition at line 135 of file Calice\-Ecal\-Calibration.\-hh.



Referenced by calibration\-Constant\-Changed(), check\-For\-Calibration\-Constants\-Of\-Module(), get\-Calibrated\-Value(), is\-Valid(), and module\-Type\-Changed().

\index{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}!\-\_\-empty@{\-\_\-empty}}
\index{\-\_\-empty@{\-\_\-empty}!CALICE::CaliceEcalCalibration@{C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration}}
\subsubsection[{\-\_\-empty}]{\setlength{\rightskip}{0pt plus 5cm}Ecal\-Module\-Calibration C\-A\-L\-I\-C\-E\-::\-Calice\-Ecal\-Calibration\-::\-\_\-empty\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}\label{classCALICE_1_1CaliceEcalCalibration_a659518967a2207c6cf2e216994450898}


Used to initialise the vector. 

Otherwise for each element for which the default constructor is called an object is created. 

Definition at line 141 of file Calice\-Ecal\-Calibration.\-hh.



Referenced by calibration\-Constant\-Changed().



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
Calice\-Ecal\-Calibration.\-hh\item 
Calice\-Ecal\-Calibration.\-cc\end{DoxyCompactItemize}
