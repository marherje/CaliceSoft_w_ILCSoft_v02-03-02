<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>RAW2CALOHIT: PedestalNoiseHistograms.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RAW2CALOHIT
   &#160;<span id="projectnumber">6.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_aa5152576b83acadfecf1e9f3e210c0e.html">calice_reco</a></li><li class="navelem"><a class="el" href="dir_27388c1674127e321e96251325cc79e9.html">raw2calohit</a></li><li class="navelem"><a class="el" href="dir_54cc96177f479d1da214f2f49b97f4f8.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PedestalNoiseHistograms.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifdef HAVE_CONFIG_H</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#  include &lt;config.h&gt;</span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;PedestalNoiseHistograms.hh&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;CellParameter.hh&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;CellParameterAccess.hh&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;histmgr/HistMgr.hh&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;histmgr/HistPar.hh&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;histmgr/FloatHistogram1D.hh&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;collection_names.hh&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;Average_t.hh&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">namespace </span>CALICE {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  PedestalNoiseHistograms a_PedestalNoiseHistograms_instance;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  PedestalNoiseHistograms::PedestalNoiseHistograms()</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    :    VRawADCValueProcessor(<span class="stringliteral">&quot;PedestalNoiseHistograms&quot;</span>)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;HistogramGroupName&quot;</span> , </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                <span class="stringliteral">&quot;The name of the histogram group under which the control histograms will be registered.&quot;</span>  ,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                _histogramGroupKey.nameStorage() ,</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                type() ) ;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    _cellParameterCollectionName=<span class="stringliteral">&quot;CellParameters&quot;</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;CellParameterCollectionName&quot;</span> , </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                <span class="stringliteral">&quot;The name of the collection which contains the pedestals, the noise, etc. of all the cells.&quot;</span> ,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                _cellParameterCollectionName ,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                                _cellParameterCollectionName);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    _noiseHistPar.clear();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    _noiseHistPar.push_back(200);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    _noiseHistPar.push_back(-100);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    _noiseHistPar.push_back(100);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;NoiseBinning&quot;</span> , </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                               <span class="stringliteral">&quot;The binning for the control histograms of the noise distribution.&quot;</span> ,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                               _noiseHistPar ,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                               _noiseHistPar ,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                               _noiseHistPar.size() ) ;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    _adcHistPar.clear();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    _adcHistPar.push_back(500);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    _adcHistPar.push_back(-1000);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    _adcHistPar.push_back(1000);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;AdcBinning&quot;</span> , </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                               <span class="stringliteral">&quot;The binning for the control histograms of the distribution of the adc values.&quot;</span> ,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                               _adcHistPar ,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                               _adcHistPar ,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                               _adcHistPar.size() ) ;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    _eventPar.clear();</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    _eventPar.push_back(100);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    _eventPar.push_back(0);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    _eventPar.push_back(200000);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;EventStepsAndRange&quot;</span> , </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                <span class="stringliteral">&quot;Event step size, first event, and last event. The history is extended in events steps given by the first parameter for events in the range indicated by the second and third parameter&quot;</span>  ,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                               _eventPar ,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                               _eventPar,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                               _eventPar.size());</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    _histKey[kH1Noise]=<a class="code" href="classhistmgr_1_1Key__t.html">histmgr::Key_t</a>(<span class="stringliteral">&quot;PadNoise&quot;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    _histKey[kH1Pedestal]=<a class="code" href="classhistmgr_1_1Key__t.html">histmgr::Key_t</a>(<span class="stringliteral">&quot;PadPedestal&quot;</span>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classCALICE_1_1PedestalNoiseHistograms.html#a1558ef3262c57736081abced8094309e">   76</a></span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::init() {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    VRawADCValueProcessor::init();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    printParameters();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    assert(_eventPar.size()==3);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    assert(_eventPar[0]&gt;0);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    assert(_eventPar[1]&lt;=_eventPar[2]);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="classhistmgr_1_1HistMgr.html">histmgr::HistMgr</a> *histogramList=histmgr::HistMgr::getInstance();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a04aa842cbcd765c10fa47afd05a31b6f">createHistogramGroup</a>(_histogramGroupKey);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    _missingCellParameters=0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classCALICE_1_1PedestalNoiseHistograms.html#ac566102ce7a3f344a139d470e184dc17">   89</a></span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::processEvent( LCEvent * evtP ) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      UInt_t event_nr=evtP-&gt;getEventNumber();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      UInt_t reco_state=<span class="keyword">static_cast&lt;</span>UInt_t<span class="keyword">&gt;</span>(evtP-&gt;getParameters().getIntVal(PAR_RECO_STATE));</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="comment">// do not use events with permanent signals</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">if</span> (reco_state==kRecoStateBeam || reco_state==kRecoStateCalibration) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="comment">//FIXME: does not make any sense if runs are chained.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">if</span> (event_nr&gt;=static_cast&lt;unsigned int&gt;(_eventPar[1]) &amp;&amp; event_nr&lt;=static_cast&lt;unsigned int&gt;(_eventPar[2])) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">if</span> (event_nr%_eventPar[0]==0) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          <a class="code" href="classhistmgr_1_1HistMgr.html">histmgr::HistMgr</a> *histogramList=histmgr::HistMgr::getInstance();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          <a class="code" href="classhistmgr_1_1HistogramCollection__t.html">histmgr::HistogramCollection_t</a> &amp; noise_hist_arr=histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a8589f54841c46f4d807c7d14a944b21b">getHistogramCollection</a>(_histogramGroupKey,_histKey[kH1Noise]);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          <a class="code" href="classhistmgr_1_1HistogramCollection__t.html">histmgr::HistogramCollection_t</a> &amp; pedestal_hist_arr=histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a8589f54841c46f4d807c7d14a944b21b">getHistogramCollection</a>(_histogramGroupKey,_histKey[kH1Pedestal]);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;          <a class="code" href="classCALICE_1_1CellParameterAccess.html">CALICE::CellParameterAccess</a> cell_parameter_col(_cellParameterCollectionName,evtP);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          UInt_t n_modules=_mapping.getNModules();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          <span class="keywordflow">for</span>(UInt_t module_i=0; module_i&lt;n_modules; module_i++) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            UInt_t n_cells=_mapping.getNCellsPerModule(module_i);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">for</span> (UInt_t cell_i=0; cell_i&lt;n_cells; cell_i++) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;              <a class="code" href="classCALICE_1_1CellParameter.html">CellParameter</a> cell_parameter=cell_parameter_col.<a class="code" href="classCALICE_1_1CellParameterAccess.html#a9d73c185b55c36fd2ee903246a5dff7d">getCellParameter</a>(module_i,cell_i);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;              noise_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#adaa8cee3a607ea20e59a4d3de2e61bea">histogram</a>(module_i,cell_i)-&gt;<a class="code" href="classhistmgr_1_1FloatHistogram1D.html#aef71989b1c5ad2fc370ee96fb4022213">fill</a>(cell_parameter.<a class="code" href="classCALICE_1_1CellParameter.html#a58d1f99e4ef0452b94fef27d5de1cc1e">getNoise</a>());</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;              pedestal_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#adaa8cee3a607ea20e59a4d3de2e61bea">histogram</a>(module_i,cell_i)-&gt;<a class="code" href="classhistmgr_1_1FloatHistogram1D.html#aef71989b1c5ad2fc370ee96fb4022213">fill</a>(cell_parameter.<a class="code" href="classCALICE_1_1CellParameter.html#a3223608e5f680b674e7181b5c4495935">getPedestal</a>());</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;          }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">catch</span> (  DataNotAvailableException err) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      _missingCellParameters++;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::end() </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;---- PedestalNoiseHistograms: report&gt;&quot;</span> &lt;&lt; std::endl</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; _missingCellParameters  &lt;&lt; <span class="stringliteral">&quot; : events without collection of cell parameter.&quot;</span>  &lt;&lt;std::endl</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;              &lt;&lt; std::endl;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classhistmgr_1_1HistMgr.html">histmgr::HistMgr</a> *histogramList=histmgr::HistMgr::getInstance();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="classhistmgr_1_1HistogramCollection__t.html">histmgr::HistogramCollection_t</a> &amp; noise_hist_arr=histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a8589f54841c46f4d807c7d14a944b21b">getHistogramCollection</a>(_histogramGroupKey,_histKey[kH1Noise]);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="classhistmgr_1_1HistogramCollection__t.html">histmgr::HistogramCollection_t</a> &amp; pedestal_hist_arr=histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a8589f54841c46f4d807c7d14a944b21b">getHistogramCollection</a>(_histogramGroupKey,_histKey[kH1Pedestal]);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifdef BOUNDARY_CHECK</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor"></span>    assert(noise_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#a02818178f9b34adc8fc34077f1111ae0">nMajor</a>() == _mapping.getNModules());</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    assert(pedestal_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#a02818178f9b34adc8fc34077f1111ae0">nMajor</a>() == _mapping.getNModules());</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#endif      </span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">&quot; Mean pedestals and noise per module: &quot;</span> &lt;&lt;std::endl;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">for</span> (UInt_t module_i=0; module_i&lt;_mapping.getNModules(); module_i++) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#ifdef BOUNDARY_CHECK</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor"></span>      assert(noise_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#aba86c24635ec931b9eef136bddaa897c">nMinor</a>(module_i) == _mapping.getNCellsPerModule(module_i) );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      assert(pedestal_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#aba86c24635ec931b9eef136bddaa897c">nMinor</a>(module_i) == _mapping.getNCellsPerModule(module_i) );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#endif      </span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor"></span>      Average_t av_noise;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      Average_t av_pedestal;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">for</span> (UInt_t cell_i=0; cell_i&lt;_mapping.getNCellsPerModule(module_i);cell_i++) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        av_noise.add(noise_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#adaa8cee3a607ea20e59a4d3de2e61bea">histogram</a>(module_i,cell_i)-&gt;mean());</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        av_pedestal.add(pedestal_hist_arr.<a class="code" href="classhistmgr_1_1HistogramCollection__t.html#adaa8cee3a607ea20e59a4d3de2e61bea">histogram</a>(module_i,cell_i)-&gt;mean());</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      av_noise.calculate();</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      av_pedestal.calculate();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; module_i &lt;&lt; <span class="stringliteral">&quot;:: noise: &quot;</span> &lt;&lt; av_noise &lt;&lt; <span class="stringliteral">&quot;   pedestal&quot;</span> &lt;&lt; av_pedestal &lt;&lt; std::endl;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::moduleTypeChanged(lcio::LCCollection* col) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    VRawADCValueProcessor::moduleTypeChanged(col);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    detectorChanged();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::moduleLocationChanged(lcio::LCCollection* col) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    VRawADCValueProcessor::moduleLocationChanged(col);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    detectorChanged();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::moduleConnectionChanged(lcio::LCCollection* col) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    VRawADCValueProcessor::moduleConnectionChanged(col);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    detectorChanged();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::detectorChanged()</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    createHistograms();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">void</span> PedestalNoiseHistograms::createHistograms() </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (!_mapping.isModuleConditionsDataComplete()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="classhistmgr_1_1HistMgr.html">histmgr::HistMgr</a> *histogramList=histmgr::HistMgr::getInstance();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (_mapping.getNModules()&gt;0) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      lcio::IntVec cell_arr;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      lcio::StringVec noise_name;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      lcio::StringVec pedestal_name;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">for</span> (UInt_t module_i=0; module_i&lt;_mapping.getNModules(); module_i++) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        cell_arr.push_back(_mapping.getNCellsPerModule(module_i));</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        std::stringstream a_name_ext;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        CellIndex cell_index(_mapping.getGeometricalCellIndex(module_i,0));</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        a_name_ext &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; _mapping.getModuleName(module_i) &lt;&lt; <span class="stringliteral">&quot;_layer_&quot;</span> &lt;&lt; cell_index.getLayerIndex();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        noise_name.push_back(std::string(<span class="stringliteral">&quot;PadNoise&quot;</span>)+a_name_ext.str());</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        pedestal_name.push_back(std::string(<span class="stringliteral">&quot;PadPedestal&quot;</span>)+a_name_ext.str());</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a777409930c14d08d7aa1c811581d1a34">createHistograms</a>(_histogramGroupKey,_histKey[kH1Noise],noise_name,cell_arr,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                                                <a class="code" href="classHistPar.html">HistPar</a>((UInt_t) _noiseHistPar[0], _noiseHistPar[1], _noiseHistPar[2]));</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      histogramList-&gt;<a class="code" href="classhistmgr_1_1HistMgr.html#a777409930c14d08d7aa1c811581d1a34">createHistograms</a>(_histogramGroupKey,_histKey[kH1Pedestal],pedestal_name,cell_arr,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                                                <a class="code" href="classHistPar.html">HistPar</a>((UInt_t) _adcHistPar[0], _adcHistPar[1], _adcHistPar[2]));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// verify code sanity: Are all the histograms created?</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    assert(kNH1==2);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div>
<div class="ttc" id="classCALICE_1_1CellParameter_html_a58d1f99e4ef0452b94fef27d5de1cc1e"><div class="ttname"><a href="classCALICE_1_1CellParameter.html#a58d1f99e4ef0452b94fef27d5de1cc1e">CALICE::CellParameter::getNoise</a></div><div class="ttdeci">Float_t getNoise() const </div><div class="ttdoc">Get the noise. </div><div class="ttdef"><b>Definition:</b> <a href="CellParameter_8hh_source.html#l00153">CellParameter.hh:153</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistogramCollection__t_html"><div class="ttname"><a href="classhistmgr_1_1HistogramCollection__t.html">histmgr::HistogramCollection_t</a></div><div class="ttdoc">One or two dimensional collection of histograms. </div><div class="ttdef"><b>Definition:</b> <a href="HistogramCollection__t_8hh_source.html#l00016">HistogramCollection_t.hh:16</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistogramCollection__t_html_aba86c24635ec931b9eef136bddaa897c"><div class="ttname"><a href="classhistmgr_1_1HistogramCollection__t.html#aba86c24635ec931b9eef136bddaa897c">histmgr::HistogramCollection_t::nMinor</a></div><div class="ttdeci">UInt_t nMinor(UInt_t major_index) const </div><div class="ttdoc">get the number of histograms in the one dimensional collection. </div><div class="ttdef"><b>Definition:</b> <a href="HistogramCollection__t_8hh_source.html#l00227">HistogramCollection_t.hh:227</a></div></div>
<div class="ttc" id="classHistPar_html"><div class="ttname"><a href="classHistPar.html">HistPar</a></div><div class="ttdoc">Class to describe the binning of equidistant histograms. </div><div class="ttdef"><b>Definition:</b> <a href="HistPar_8hh_source.html#l00008">HistPar.hh:8</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistMgr_html_a04aa842cbcd765c10fa47afd05a31b6f"><div class="ttname"><a href="classhistmgr_1_1HistMgr.html#a04aa842cbcd765c10fa47afd05a31b6f">histmgr::HistMgr::createHistogramGroup</a></div><div class="ttdeci">void createHistogramGroup(const Key_t &amp;group_key)</div><div class="ttdoc">Create an empty histogram group to which histograms can be assigned. </div><div class="ttdef"><b>Definition:</b> <a href="HistMgr_8hh_source.html#l00313">HistMgr.hh:313</a></div></div>
<div class="ttc" id="classhistmgr_1_1FloatHistogram1D_html_aef71989b1c5ad2fc370ee96fb4022213"><div class="ttname"><a href="classhistmgr_1_1FloatHistogram1D.html#aef71989b1c5ad2fc370ee96fb4022213">histmgr::FloatHistogram1D::fill</a></div><div class="ttdeci">void fill(Float_t value, Float_t weight=1.)</div><div class="ttdoc">fill a value into the histogram </div><div class="ttdef"><b>Definition:</b> <a href="FloatHistogram1D_8hh_source.html#l00104">FloatHistogram1D.hh:104</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistogramCollection__t_html_adaa8cee3a607ea20e59a4d3de2e61bea"><div class="ttname"><a href="classhistmgr_1_1HistogramCollection__t.html#adaa8cee3a607ea20e59a4d3de2e61bea">histmgr::HistogramCollection_t::histogram</a></div><div class="ttdeci">const FloatHistogram1D * histogram(UInt_t index) const </div><div class="ttdoc">Get one histogram of the collection (read only). </div><div class="ttdef"><b>Definition:</b> <a href="HistogramCollection__t_8hh_source.html#l00233">HistogramCollection_t.hh:233</a></div></div>
<div class="ttc" id="classCALICE_1_1CellParameter_html"><div class="ttname"><a href="classCALICE_1_1CellParameter.html">CALICE::CellParameter</a></div><div class="ttdoc">Information about a pad: Pedestal, noise, etc. </div><div class="ttdef"><b>Definition:</b> <a href="CellParameter_8hh_source.html#l00070">CellParameter.hh:70</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistMgr_html_a777409930c14d08d7aa1c811581d1a34"><div class="ttname"><a href="classhistmgr_1_1HistMgr.html#a777409930c14d08d7aa1c811581d1a34">histmgr::HistMgr::createHistograms</a></div><div class="ttdeci">lcio::LCCollection * createHistograms(const Key_t &amp;group_key, const Key_t &amp;collection_key, UInt_t n_hist, const HistPar &amp;par, bool may_overwrite=false) noexcept(false)</div><div class="ttdoc">create several histograms which will have the same binning and the same name (except of a numeric ext...</div><div class="ttdef"><b>Definition:</b> <a href="HistMgr_8hh_source.html#l00341">HistMgr.hh:341</a></div></div>
<div class="ttc" id="classhistmgr_1_1Key__t_html"><div class="ttname"><a href="classhistmgr_1_1Key__t.html">histmgr::Key_t</a></div><div class="ttdoc">A string key which will get a numeric identifier. </div><div class="ttdef"><b>Definition:</b> <a href="Key__t_8hh_source.html#l00016">Key_t.hh:16</a></div></div>
<div class="ttc" id="classCALICE_1_1CellParameterAccess_html"><div class="ttname"><a href="classCALICE_1_1CellParameterAccess.html">CALICE::CellParameterAccess</a></div><div class="ttdoc">Wrapper around the cell parameter collection to facilitate the access. </div><div class="ttdef"><b>Definition:</b> <a href="CellParameterAccess_8hh_source.html#l00017">CellParameterAccess.hh:17</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistogramCollection__t_html_a02818178f9b34adc8fc34077f1111ae0"><div class="ttname"><a href="classhistmgr_1_1HistogramCollection__t.html#a02818178f9b34adc8fc34077f1111ae0">histmgr::HistogramCollection_t::nMajor</a></div><div class="ttdeci">UInt_t nMajor() const </div><div class="ttdoc">get the number of histograms in the one dimensional collection. </div><div class="ttdef"><b>Definition:</b> <a href="HistogramCollection__t_8hh_source.html#l00219">HistogramCollection_t.hh:219</a></div></div>
<div class="ttc" id="classCALICE_1_1CellParameterAccess_html_a9d73c185b55c36fd2ee903246a5dff7d"><div class="ttname"><a href="classCALICE_1_1CellParameterAccess.html#a9d73c185b55c36fd2ee903246a5dff7d">CALICE::CellParameterAccess::getCellParameter</a></div><div class="ttdeci">CellParameter getCellParameter(UInt_t module_index, UInt_t cell_index)</div><div class="ttdoc">Get the cell parameters of the specified cell (read/write). </div><div class="ttdef"><b>Definition:</b> <a href="CellParameterAccess_8hh_source.html#l00075">CellParameterAccess.hh:75</a></div></div>
<div class="ttc" id="classCALICE_1_1CellParameter_html_a3223608e5f680b674e7181b5c4495935"><div class="ttname"><a href="classCALICE_1_1CellParameter.html#a3223608e5f680b674e7181b5c4495935">CALICE::CellParameter::getPedestal</a></div><div class="ttdeci">Float_t getPedestal() const </div><div class="ttdoc">Get the pedestal. </div><div class="ttdef"><b>Definition:</b> <a href="CellParameter_8hh_source.html#l00131">CellParameter.hh:131</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistMgr_html"><div class="ttname"><a href="classhistmgr_1_1HistMgr.html">histmgr::HistMgr</a></div><div class="ttdoc">Manages lists of histograms which can be written to prior assigned files. </div><div class="ttdef"><b>Definition:</b> <a href="HistMgr_8hh_source.html#l00043">HistMgr.hh:43</a></div></div>
<div class="ttc" id="classhistmgr_1_1HistMgr_html_a8589f54841c46f4d807c7d14a944b21b"><div class="ttname"><a href="classhistmgr_1_1HistMgr.html#a8589f54841c46f4d807c7d14a944b21b">histmgr::HistMgr::getHistogramCollection</a></div><div class="ttdeci">HistogramCollection_t &amp; getHistogramCollection(const Key_t &amp;group_key, const Key_t &amp;hist_key)</div><div class="ttdoc">get the one or two dimensional histogram collection. </div><div class="ttdef"><b>Definition:</b> <a href="HistMgr_8hh_source.html#l00824">HistMgr.hh:824</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
