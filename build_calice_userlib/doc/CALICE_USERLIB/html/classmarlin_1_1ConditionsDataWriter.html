<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>CALICE_USERLIB: marlin::ConditionsDataWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CALICE_USERLIB
   &#160;<span id="projectnumber">6.7.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacemarlin.html">marlin</a></li><li class="navelem"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html">ConditionsDataWriter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">marlin::ConditionsDataWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Marlin processr which catches selected conditions data changes and writes them to the conditions data base.  
 <a href="classmarlin_1_1ConditionsDataWriter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for marlin::ConditionsDataWriter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classmarlin_1_1ConditionsDataWriter.png" usemap="#marlin::ConditionsDataWriter_map" alt=""/>
  <map id="marlin::ConditionsDataWriter_map" name="marlin::ConditionsDataWriter_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a360478d5d28f2e5012ef5e0e5201821a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a360478d5d28f2e5012ef5e0e5201821a"></a>
Processor *&#160;</td><td class="memItemRight" valign="bottom"><b>newProcessor</b> ()</td></tr>
<tr class="separator:a360478d5d28f2e5012ef5e0e5201821a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c0b9b141b58a82aaf7df60939bf114"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a71c0b9b141b58a82aaf7df60939bf114">init</a> ()</td></tr>
<tr class="memdesc:a71c0b9b141b58a82aaf7df60939bf114"><td class="mdescLeft">&#160;</td><td class="mdescRight">Install conditions change listener.  <a href="#a71c0b9b141b58a82aaf7df60939bf114">More...</a><br/></td></tr>
<tr class="separator:a71c0b9b141b58a82aaf7df60939bf114"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a943dd58f7e315e2ded7f49a77211eb82"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a943dd58f7e315e2ded7f49a77211eb82"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a943dd58f7e315e2ded7f49a77211eb82">processRunHeader</a> (LCRunHeader *run)</td></tr>
<tr class="memdesc:a943dd58f7e315e2ded7f49a77211eb82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do nothing at run start. <br/></td></tr>
<tr class="separator:a943dd58f7e315e2ded7f49a77211eb82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa20ee1d0fcaa87334896a5e5b86920e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#afa20ee1d0fcaa87334896a5e5b86920e">processEvent</a> (LCEvent *evtP)</td></tr>
<tr class="memdesc:afa20ee1d0fcaa87334896a5e5b86920e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Memorise the event time stamps.  <a href="#afa20ee1d0fcaa87334896a5e5b86920e">More...</a><br/></td></tr>
<tr class="separator:afa20ee1d0fcaa87334896a5e5b86920e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ece634cea5d95989d574c128d303006"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a8ece634cea5d95989d574c128d303006">end</a> ()</td></tr>
<tr class="memdesc:a8ece634cea5d95989d574c128d303006"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write all not yet written conditions data to the conditions data base.  <a href="#a8ece634cea5d95989d574c128d303006">More...</a><br/></td></tr>
<tr class="separator:a8ece634cea5d95989d574c128d303006"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c8683f0e6055c27c991a6f31d5d69a9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8c8683f0e6055c27c991a6f31d5d69a9"></a>
long64&#160;</td><td class="memItemRight" valign="bottom"><b>getTimeStampOfLastEvent</b> () const </td></tr>
<tr class="separator:a8c8683f0e6055c27c991a6f31d5d69a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ad87dadf50a9e475515ea26bce299e449"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#ad87dadf50a9e475515ea26bce299e449">_dbInit</a></td></tr>
<tr class="memdesc:ad87dadf50a9e475515ea26bce299e449"><td class="mdescLeft">&#160;</td><td class="mdescRight">parameter to be filled with the host name, database name,user name and the password.  <a href="#ad87dadf50a9e475515ea26bce299e449">More...</a><br/></td></tr>
<tr class="separator:ad87dadf50a9e475515ea26bce299e449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec7c975d8f23f11e20dc1911ce57bb2c"><td class="memItemLeft" align="right" valign="top">StringVec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#aec7c975d8f23f11e20dc1911ce57bb2c">_condDataCollections</a></td></tr>
<tr class="memdesc:aec7c975d8f23f11e20dc1911ce57bb2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">collection name, destination CondDB folder and version of the conditions data to be written to the conditions database.  <a href="#aec7c975d8f23f11e20dc1911ce57bb2c">More...</a><br/></td></tr>
<tr class="separator:aec7c975d8f23f11e20dc1911ce57bb2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2c6e1b189e2f665f8ef6beb7ad9c10b"><td class="memItemLeft" align="right" valign="top">long64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#af2c6e1b189e2f665f8ef6beb7ad9c10b">_timeStampOfLastEvent</a></td></tr>
<tr class="memdesc:af2c6e1b189e2f665f8ef6beb7ad9c10b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The time stamp of the last event that was processed.  <a href="#af2c6e1b189e2f665f8ef6beb7ad9c10b">More...</a><br/></td></tr>
<tr class="separator:af2c6e1b189e2f665f8ef6beb7ad9c10b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68d96e4787ed480558b5b3088cd3321f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a68d96e4787ed480558b5b3088cd3321f"></a>
std::vector<br class="typebreak"/>
&lt; <a class="el" href="classCALICE_1_1ConditionsDataWriteHandler.html">CALICE::ConditionsDataWriteHandler</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>_handler</b></td></tr>
<tr class="separator:a68d96e4787ed480558b5b3088cd3321f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a0e401bb1bfedeba5808934499877adf4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e401bb1bfedeba5808934499877adf4"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>CALICE::ConditionsDataWriteHandler</b></td></tr>
<tr class="separator:a0e401bb1bfedeba5808934499877adf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Marlin processr which catches selected conditions data changes and writes them to the conditions data base. </p>
<p>The processor does not verify whether the data already exists it writes every change to the database.</p>
<p>The conditions data changes are catched by individual handlers which clone the conditions data collection and store the cloned collection when the handler is notified of the next change.</p>
<p>The conditions data change handler does not have any knowledge of the record time which triggered the conditions data change. To solve this problem, the handlers request a correction of the since time stamp. This request will be approximatively fulfilled by setting the since time stamp to the time stamp of the event which arrived just after the conditions data change. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00036">36</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a8ece634cea5d95989d574c128d303006"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write all not yet written conditions data to the conditions data base. </p>
<p>The writing of the conditions data is delayed until the conditions data changes to set the "since" and "till" time stamps. All the conditions data which is not yet stored in the conditions database is written now. Finally if the the version is not HEAD, the folders are tagged. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00109">109</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a71c0b9b141b58a82aaf7df60939bf114"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Install conditions change listener. </p>
<p>The listeners are installed for the conditions data specified by the processor parameters. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00041">41</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

</div>
</div>
<a class="anchor" id="afa20ee1d0fcaa87334896a5e5b86920e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::processEvent </td>
          <td>(</td>
          <td class="paramtype">LCEvent *&#160;</td>
          <td class="paramname"><em>evtP</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Memorise the event time stamps. </p>
<p>The time stamp of the last event before the member function end is called is needed to write the dangling conditions data with correct "since" and "till" time stamps to the conditions data base. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00094">94</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a class="anchor" id="aec7c975d8f23f11e20dc1911ce57bb2c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StringVec marlin::ConditionsDataWriter::_condDataCollections</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>collection name, destination CondDB folder and version of the conditions data to be written to the conditions database. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00077">77</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

</div>
</div>
<a class="anchor" id="ad87dadf50a9e475515ea26bce299e449"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string marlin::ConditionsDataWriter::_dbInit</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>parameter to be filled with the host name, database name,user name and the password. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00072">72</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

</div>
</div>
<a class="anchor" id="af2c6e1b189e2f665f8ef6beb7ad9c10b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long64 marlin::ConditionsDataWriter::_timeStampOfLastEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The time stamp of the last event that was processed. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00080">80</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a></li>
<li><a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
