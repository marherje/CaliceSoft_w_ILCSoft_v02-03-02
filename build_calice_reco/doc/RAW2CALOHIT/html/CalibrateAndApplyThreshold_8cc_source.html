<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>RAW2CALOHIT: CalibrateAndApplyThreshold.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RAW2CALOHIT
   &#160;<span id="projectnumber">6.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_aa5152576b83acadfecf1e9f3e210c0e.html">calice_reco</a></li><li class="navelem"><a class="el" href="dir_27388c1674127e321e96251325cc79e9.html">raw2calohit</a></li><li class="navelem"><a class="el" href="dir_54cc96177f479d1da214f2f49b97f4f8.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CalibrateAndApplyThreshold.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;TH1F.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCCollection.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCEvent.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;EVENT/RawCalorimeterHit.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;EVENT/SimCalorimeterHit.h&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCObject.h&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCParameters.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCFloatVec.h&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;IMPL/CalorimeterHitImpl.h&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;IMPL/LCCollectionVec.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;EVENT/LCRelation.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;IMPL/LCFlagImpl.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;UTIL/LCRelationNavigator.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;lccd/LCConditionsMgr.hh&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;ErrorBits.hh&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;CalibrationFactory.hh&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;NoOpCalibration.hh&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;Calibration.hh&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;marlin/ConditionsProcessor.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;marlin/Global.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;CalibrateAndApplyThreshold.hh&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;CellIndex.hh&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;NoiseParameter.hh&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;LCPayload.hh&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;SimpleHitSearch.hh&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using namespace </span>lcio;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">using namespace </span>marlin;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">namespace </span>CALICE {<span class="comment">//namespace CALICE</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;   CalibrateAndApplyThreshold b;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classCALICE_1_1CalibrateAndApplyThreshold.html#ae2d615ca7797434d642f1ae6d6950974">   46</a></span>&#160;  CalibrateAndApplyThreshold::CalibrateAndApplyThreshold()</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    : <a class="code" href="classCALICE_1_1VRawADCValueProcessor.html">VRawADCValueProcessor</a>(<span class="stringliteral">&quot;CalibrateAndApplyThreshold&quot;</span>),</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      _calibration(new <a class="code" href="classNoOpCalibration.html">NoOpCalibration</a>),</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      _cellCol(0),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      _nEventsWithoutRAWHITS(0),</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      _nEventsWithoutSIMHITS(0),</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      _nEvt(0),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      _hfile(0),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      _detectorTransformationChange(this,&amp;<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html">CalibrateAndApplyThreshold</a>::detectorTransformationChanged),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      _referenceTransformationChange(this,&amp;<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html">CalibrateAndApplyThreshold</a>::referenceTransformationChanged)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;SaveHistograms&quot;</span> ,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                               <span class="stringliteral">&quot;Create a rootfile with control histograms&quot;</span> ,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                               _saveHistograms ,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                static_cast&lt;int&gt;(0));</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3a6f0a6d75fa972ac6303604bb515fc7">_rawhitColName</a>=COL_RAWHITS;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;RawHitCollectionName&quot;</span> ,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                               <span class="stringliteral">&quot;The name of the Rawcalorimeter hit collection (input) to be used&quot;</span> ,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3a6f0a6d75fa972ac6303604bb515fc7">_rawhitColName</a> ,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3a6f0a6d75fa972ac6303604bb515fc7">_rawhitColName</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;InputRelCollections&quot;</span>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                                <span class="stringliteral">&quot;Names of relation collections with simhits&quot;</span>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                                <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a75f2b80baf0f8691c9d921d70bafb649">_RawToSimColName</a>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                std::string(<span class="stringliteral">&quot;EcalProtoRaw2sim&quot;</span>) );</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a10dd53b4f7d1514791ec6c60329aaea4">_hitColName</a>=COL_HITS;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;HitCollectionName&quot;</span> ,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                               <span class="stringliteral">&quot;The name of the calorimeter hit collection (output) to be used&quot;</span> ,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a10dd53b4f7d1514791ec6c60329aaea4">_hitColName</a> ,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a10dd53b4f7d1514791ec6c60329aaea4">_hitColName</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    _cellParameterCollectionName=<span class="stringliteral">&quot;EmcCellParameters&quot;</span>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;CellParameterCollectionName&quot;</span> ,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                               <span class="stringliteral">&quot;The name of the collection which contains the pedestals, the noise, etc. of all the cells.&quot;</span> ,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                               _cellParameterCollectionName ,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                               _cellParameterCollectionName);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// ---- collection name of calibration constants and name of calibration object</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;Calibration&quot;</span> ,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                <span class="stringliteral">&quot;Name of object to be used for the calibration&quot;</span>  ,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a36efa661235242659c74a49235164662">_calibrationObjectName</a> ,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                std::string(<span class="stringliteral">&quot;NoOpCalibration&quot;</span>) ) ;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;CalibrationConstants&quot;</span> ,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                               <span class="stringliteral">&quot;Name of the conditions data collection which contains the calibration constants&quot;</span>  ,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a79e5cf6fc879e14cdd3c68f88b1ff7c1">_calibrationConstantColName</a> ,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                               std::string(<span class="stringliteral">&quot;&quot;</span>) );</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// --- detector position</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;DetectorTransformationCollectionName&quot;</span> ,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                <span class="stringliteral">&quot;Name of the conditions data collection which describes the detector position and rotation (folder e.g. /Calice/ECAL/Transformation)&quot;</span>  ,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                                <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">_colNameDetectorTransformation</a> ,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                std::string(<span class="stringliteral">&quot;DetectorTransformation&quot;</span>) ) ;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    registerOptionalParameter( <span class="stringliteral">&quot;ReferenceTransformationCollectionName&quot;</span> ,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                <span class="stringliteral">&quot;Name of the conditions data collection which describes the position and rotation of the reference coordinate system (folder e.g. /Calice/ECAL/Transformation)&quot;</span>  ,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">_colNameReferenceTransformation</a> ,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                std::string(<span class="stringliteral">&quot;ReferenceTransformation&quot;</span>) ) ;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">_colNameReferenceTransformation</a>=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">_colNameDetectorTransformation</a>=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">_signalThreshold</a> = .5;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;SignalThreshold&quot;</span> ,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                               <span class="stringliteral">&quot;Cells with a signal (after calibration) larger than this threshold are considered to have a hit. &quot;</span> ,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">_signalThreshold</a> ,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">_signalThreshold</a> ) ;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a>.clear();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a>.push_back( 5.);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;NoiseCut&quot;</span> ,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                               <span class="stringliteral">&quot;Cells with a signal-to-noise ratio larger than this value are considered to have a hit. The first element is used for hit search the second for hit rejection during noise calculation.&quot;</span> ,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a> ,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                               <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a>) ;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;LinkRecToSim&quot;</span>, <span class="stringliteral">&quot;Create link reconstricted -&gt; simulated hit&quot;</span>, <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#aba8a11b61c43b9339e3140839fc5b213">_linkRecToSim</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;LinkRecToSimCollectionName&quot;</span>, <span class="stringliteral">&quot;Name of the link reconstructed -&gt; simulated hit collection&quot;</span>, <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a6ba0e8c707c10c6ace7b034293d34035">_RecToSimColName</a>, std::string(<span class="stringliteral">&quot;EmcRecToSim&quot;</span>));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">//CRP 26/11/15 </span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    _fallbackShift = 10000.;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    registerProcessorParameter( <span class="stringliteral">&quot;FallBackShift&quot;</span> ,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                               <span class="stringliteral">&quot; Define a shift for cells which cannot be properly handled since they were present in the simulation but not in the data (e.g. DESY 2005, CERN 2006/2007&quot;</span> ,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                               _fallbackShift ,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                               _fallbackShift ) ;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a1318d9f3f1a695b1996c30c63c47d085">  138</a></span>&#160;  <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a1318d9f3f1a695b1996c30c63c47d085">CalibrateAndApplyThreshold::~CalibrateAndApplyThreshold</a>() {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keyword">delete</span> _calibration;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a69d43c0be2a238e99828c918003bde74">  142</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a69d43c0be2a238e99828c918003bde74">CalibrateAndApplyThreshold::init</a>()</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  {<span class="comment">//init</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    std::stringstream message;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">bool</span> error=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      VRawADCValueProcessor::init();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">catch</span> (<a class="code" href="classCALICE_1_1ErrorMissingConditionsDataHandler.html">ErrorMissingConditionsDataHandler</a> &amp;conddata_error) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="comment">// --- catch conditions data handler registration errors</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="comment">//   ... and build a combined error message.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      std::string a(conddata_error.what());</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      error=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span> (a.size()&gt;0) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        a.erase(a.size()-1);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        message &lt;&lt; a;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// --- register conditions data handler</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (!error) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      message &lt;&lt; <span class="stringliteral">&quot;CalibrateAndApplyThreshold::init&gt; no conditions data handler for the collections:&quot;</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">_colNameDetectorTransformation</a>.empty()) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">if</span> (!marlin::ConditionsProcessor::registerChangeListener( &amp;<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a9f46c5087b5975ec06c36e9da4f33378">_detectorTransformationChange</a> ,<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">_colNameDetectorTransformation</a>) ) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        message &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">_colNameDetectorTransformation</a>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        error=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">_colNameReferenceTransformation</a>.empty()) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (!marlin::ConditionsProcessor::registerChangeListener( &amp;<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a1e6bdda0ecedd7a21053f54f178478b1">_referenceTransformationChange</a> ,<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">_colNameReferenceTransformation</a>) ) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        message &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">_colNameReferenceTransformation</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        error=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (error) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="comment">// also throw an exception if the registration of conditions data handlers failed in VRawADCValueProcessor::init</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      message &lt;&lt;  <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="classCALICE_1_1ErrorMissingConditionsDataHandler.html">ErrorMissingConditionsDataHandler</a>(message.str());</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">//_cellParameter.clear();</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    printParameters();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">//_nEventsWithoutRAWHITS = 0;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">//_nEvt = 0;</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// --- Calibration object</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">delete</span> _calibration;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="classCalibrationFactory.html#a5efb95a0d951b8da5a8bdb5832a9831d">CalibrationFactory::getInstance</a>()-&gt;<a class="code" href="classCalibrationFactory.html#a8ec8e4dacbc4b38c7fd760b7b00857d3">listKits</a>();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    _calibration=<a class="code" href="classCalibrationFactory.html#a5efb95a0d951b8da5a8bdb5832a9831d">CalibrationFactory::getInstance</a>()-&gt;<a class="code" href="classCalibrationFactory.html#a1682bde6eef1a7ff023421abc8bf4534">createCalibrationObject</a>(<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a36efa661235242659c74a49235164662">_calibrationObjectName</a>, <a class="code" href="classCALICE_1_1VRawADCValueProcessor.html#a7c7446a4e691d62dbeaaf09d64122af0">_colNameModuleDescription</a>, <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a79e5cf6fc879e14cdd3c68f88b1ff7c1">_calibrationConstantColName</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">if</span> (!_calibration) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      std::stringstream message;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      message &lt;&lt; <span class="stringliteral">&quot;SimpleHitSearch::init&gt; Failed to create calibration object \&quot;&quot;</span> &lt;&lt; <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a36efa661235242659c74a49235164662">_calibrationObjectName</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;.&quot;</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(message.str());</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// --- initialise the analysis</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a>.size()&lt;1) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a457ab672e3467ed409a58e42e4aa6229">_noiseCut</a>=5;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a457ab672e3467ed409a58e42e4aa6229">_noiseCut</a>=<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">_noiseCutVec</a>[0];</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;NoiseCut = &quot;</span> &lt;&lt; <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a457ab672e3467ed409a58e42e4aa6229">_noiseCut</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  }<span class="comment">//init</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3bd3d21d979363fa105e7cea54148502">  217</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3bd3d21d979363fa105e7cea54148502">CalibrateAndApplyThreshold::processRunHeader</a>( LCRunHeader* run){</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;CalibrateAndApplyThreshold::processRu()  &quot;</span> &lt;&lt; name()</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; in run &quot;</span> &lt;&lt; run-&gt;getRunNumber()</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;              &lt;&lt; std::endl ;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    _runInfo.get(run);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    _runInfo.print();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">//fill an LCParameter with the list of cellIDs of the dead cells</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">//dead = not connected (in connected PCBs) or calibration constant is not valid</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">//obtained from the Calice database</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    EVENT::IntVec Vec;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (_mapping.isModuleConditionsDataComplete()) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_modules = _mapping.getNModules();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">for</span> (UInt_t module_i=0; module_i&lt;n_modules; module_i++) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        UInt_t cells_per_module=_mapping.getNCellsPerModule(module_i);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">for</span> (UInt_t cell_i=0; cell_i&lt;cells_per_module; cell_i++) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          <span class="keywordflow">if</span> (_mapping.isCellDead(module_i,cell_i) || !_calibration-&gt;<a class="code" href="classCalibration.html#a7d516d7b66b1f20640829d12adfd64d6">isValid</a>(_mapping.getModuleID(module_i),_mapping.getModuleType(module_i),cell_i)){</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            Vec.push_back(_mapping.getGeometricalCellIndex(module_i,cell_i));</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    (run-&gt;parameters()).setValues(<span class="stringliteral">&quot;DeadCells&quot;</span>,Vec);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a2c3e34db11fe08fab2b184cc87f4d7b5">  247</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a2c3e34db11fe08fab2b184cc87f4d7b5">CalibrateAndApplyThreshold::processEvent</a>( LCEvent * evtP )</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  {<span class="comment">//processEvt</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">//static bool firstEvent = true;</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">try</span> {<span class="comment">//try</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">//FIXME: check there is rawhits in the collection, else, do nothing, a mssing raw collection might indicate a  serious</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">//problem, error catching to be updated.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      LCCollection* col_rawhits = evtP-&gt;getCollection( <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3a6f0a6d75fa972ac6303604bb515fc7">_rawhitColName</a> ) ;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_modules = _mapping.getNModules();</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="comment">//then, access the cell parameters. For data, it will be the ones saved in SimpleHitSearch or in the cellParam collection, but for MC it will be created for the first event only from the database collection.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="classSimpleArray__t.html">NoiseParameterArray_t</a> &amp;noiseArray = SimpleHitSearch::getCellParameters();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">if</span> (!_runInfo.isMC() &amp;&amp; noiseArray.size() == 0) {<span class="comment">//data when SimpleHitSearch is not run before</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        _cellCol = evtP-&gt;getCollection( _cellParameterCollectionName );</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        noiseArray.clear();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span> (noiseArray.size()!=n_modules) noiseArray.resize(n_modules);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nHits = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(_cellCol-&gt;getNumberOfElements());</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> element = 0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">for</span> (UInt_t mod = 0; mod &lt; n_modules; mod++){<span class="comment">//loop on modules</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          <span class="keywordflow">for</span> (UInt_t cell = 0; cell &lt; _mapping.getNCellsPerModule(mod); cell++){</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> (element &gt;= nHits) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;              std::stringstream message;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;              message &lt;&lt; <span class="stringliteral">&quot;CalibrateAndApplyThreshold::ProcessEvent&gt; ERROR: found more elements than saved in the cell parameter collection ! n_modules = &quot;</span> &lt;&lt; n_modules &lt;&lt; <span class="stringliteral">&quot;, and number of elements in collection &quot;</span> &lt;&lt; _cellParameterCollectionName &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; nHits &lt;&lt; std::endl;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;              <span class="keywordflow">throw</span> runtime_error(message.str());</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="keyword">const</span> <a class="code" href="classLCPayload.html">LCPayload&lt;NoiseParameter&gt;</a> p(dynamic_cast&lt;LCGenericObject*&gt;(_cellCol-&gt;getElementAt(element)));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <a class="code" href="classCALICE_1_1NoiseParameter.html">NoiseParameter</a> noisePar = p.payload();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            noiseArray[mod].push_back(noisePar);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            element++;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      }<span class="comment">//data</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_runInfo.isMC()) {<span class="comment">//isMC</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment">//need to copy the parameters from the collection saved with digi step. takeCollection allows the same parameters to be read for each events, as the collection will exist only in the first event.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">//if (firstEvent) _cellCol = evtP-&gt;takeCollection( _cellParameterCollectionName );</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        noiseArray.clear();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> (noiseArray.size()!=30) noiseArray.resize(30);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">//CRP 25/11/15 Take out the try block as a missing handler in the following is not correctly caught by lccd </span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment">//try {</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <span class="comment">//Protect against missing handler (happens if you don&#39;t use existing tools!!!!!)</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          <span class="keywordflow">if</span>(lccd::LCConditionsMgr::instance()-&gt;getHandler(_cellParameterCollectionName)){</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            _cellCol = (lccd::LCConditionsMgr::instance()-&gt;getHandler(_cellParameterCollectionName))-&gt;currentCollection();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;           <span class="comment">//CRP 25/11/15 Remark no further check for non null pointer needed since LCCD either returns a collection or</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;           <span class="comment">//throws and exception, see e.g. DBCondHandler.cc in LCCD </span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;           <span class="comment">//Hardcoded and ugly!!!!!!</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            assert (_cellCol-&gt;getNumberOfElements() == 30*324);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="keywordflow">for</span> (UInt_t element_i=0; element_i &lt; static_cast&lt;UInt_t&gt;(_cellCol-&gt;getNumberOfElements()); element_i++) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;              <span class="keyword">const</span> <a class="code" href="classLCPayload.html">LCPayload&lt;NoiseParameter&gt;</a> p(dynamic_cast&lt;LCGenericObject*&gt;(_cellCol-&gt;getElementAt(element_i)));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;              <a class="code" href="classCALICE_1_1NoiseParameter.html">NoiseParameter</a> noisePar = p.payload();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;              CellIndex dec(noisePar.getGeomCellIndex());</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;              assert (dec.getLayerIndex() &gt; 0 &amp;&amp; dec.getLayerIndex() &lt; 31);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;              noiseArray[dec.getLayerIndex()-1].push_back(noisePar);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="comment">//CRP 25/11/15 Not very nice to throw an exception that normally lccd should throw (in LCConditionsMgr::getHandler) </span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="comment">//but it&#39;s the cleanest way here </span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment">//since after all a request for a conditions data collection has failed</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          } <span class="keywordflow">else</span> {<span class="keywordflow">throw</span> lccd::LCCDException(<span class="stringliteral">&quot; CALICE::CalibrateAndApplyThreshold: no handler &quot;</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                            <span class="stringliteral">&quot; for name: &quot;</span> + _cellParameterCollectionName) ; }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          <span class="comment">//Leave the catch block in for future correction of lccd</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          <span class="comment">//} catch ( DataNotAvailableException &amp;err ){</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;No cell parameter collection for event&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="comment">//}</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      }<span class="comment">//isMC</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (noiseArray.size() &lt; n_modules ) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        std::stringstream message;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        message &lt;&lt; <span class="stringliteral">&quot; ERROR : wrong access to the cell parameters in data ! Size of the array should be at least &quot;</span> &lt;&lt; _mapping.getNModules() &lt;&lt; <span class="stringliteral">&quot; and is : &quot;</span> &lt;&lt; noiseArray.size() &lt;&lt; <span class="stringliteral">&quot;. Exiting....&quot;</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(message.str());</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">//next step, loop over rawHits, calibrate and copy the ones above threshold in the output collection.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">//the relation collection is needed for MC events, to copy the position from the simhits for not connected layers where the mapping doesn&#39;t exist.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      LCCollection* col_RawToSim = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">if</span> (_runInfo.isMC()) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">try</span> {col_RawToSim = evtP-&gt;getCollection(<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a75f2b80baf0f8691c9d921d70bafb649">_RawToSimColName</a>); }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">catch</span> ( DataNotAvailableException &amp;err ){</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          streamlog_out(DEBUG) &lt;&lt; <span class="stringliteral">&quot;CalibrateAndApplyThreshold&gt;&gt;processEvent: No relation rawhits &lt;-&gt; Simhits. Missing SimHits?&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;          _nEventsWithoutSIMHITS++;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      LCCollection* col_hit=<span class="keyword">new</span> LCCollectionVec( LCIO::CALORIMETERHIT );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      EVENT::LCParameters &amp; theParam = col_hit-&gt;parameters();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="comment">//Set the cell decoder which might be useful in event displays</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">//suggested by Allister</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">//hardcoded, no good, should be created somehow automatically</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="comment">//theParam.setValue(LCIO::CellIDEncoding,&quot;M:3,S-1:3,I:9,J:9,K-1:6&quot;);</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      theParam.setValue(LCIO::CellIDEncoding,_mapping.getCellIDEncoding());</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#ifdef EXPORT_SIGNAL_TO_NOISE_RATIO</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor"></span>      LCFloatVec signal_over_noise_ratio;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      signal_over_noise_ratio.clear();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor"></span>      <span class="comment">// write 3d coordinates</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      LCFlagImpl hitFlag(col_hit-&gt;getFlag()) ;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      hitFlag.setBit( LCIO::RCHBIT_LONG) ;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      hitFlag.setBit( LCIO::RCHBIT_ID1) ;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      col_hit-&gt;setFlag( hitFlag.getFlag()  ) ;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      Int_t minAdcSignalThreshold = _calibration-&gt;<a class="code" href="classCalibration.html#a4e45f1eca0d4fdf19ad76b8f581aee12">getMiniumADCForMipThreshold</a>(<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">_signalThreshold</a>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">if</span> (col_rawhits &amp;&amp; col_rawhits-&gt;getNumberOfElements()&gt;0) {<span class="comment">//if input col</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        LCRelationNavigator nav_RecToSim(LCIO::CALORIMETERHIT, LCIO::SIMCALORIMETERHIT);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ele = 0; ele &lt; col_rawhits-&gt;getNumberOfElements(); ele++)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          {<span class="comment">//loop on raw hits</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            RawCalorimeterHit *hit_raw = <span class="keyword">dynamic_cast&lt;</span>RawCalorimeterHit*<span class="keyword">&gt;</span>(col_rawhits-&gt;getElementAt(ele));</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            CellIndex mydec(hit_raw-&gt;getCellID0(),hit_raw-&gt;getCellID1());</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            UInt_t K = mydec.getLayerIndex();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#ifdef BOUNDARY_CHECK</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor"></span>              <span class="keywordflow">if</span> ( !(mydec.getLayerIndex() &gt;= 1 &amp;&amp; mydec.getLayerIndex() &lt;= 30) ||</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                   !(mydec.getWaferRow() &gt;= 1 &amp;&amp; mydec.getWaferRow() &lt;= 3) ||</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                   !(mydec.getWaferColumn() &gt;= 1 &amp;&amp; mydec.getWaferColumn() &lt;= 3)||</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                   !(mydec.getPadRow() &gt;= 1 &amp;&amp; mydec.getPadRow() &lt;= 6)||</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                   !(mydec.getPadColumn() &gt;= 1 &amp;&amp; mydec.getPadColumn() &lt;= 6))</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot; CalibrateAndApplyThreshold::WRONG decoding of indices ! &quot;</span> &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                    <span class="stringliteral">&quot; CellID0 = &quot;</span> &lt;&lt; hit_raw-&gt;getCellID0() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <span class="stringliteral">&quot; CellID1 = &quot;</span> &lt;&lt; hit_raw-&gt;getCellID1() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    <span class="stringliteral">&quot; Layer = &quot;</span> &lt;&lt; mydec.getLayerIndex() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    <span class="stringliteral">&quot; Wafer Row (M) = &quot;</span> &lt;&lt; mydec.getWaferRow() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    <span class="stringliteral">&quot; Wafer Column (S) = &quot;</span> &lt;&lt; mydec.getWaferColumn() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="stringliteral">&quot; Pad Row (I) = &quot;</span> &lt;&lt; mydec.getPadRow() &lt;&lt; std::endl &lt;&lt;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="stringliteral">&quot; Pad Column (J) = &quot;</span> &lt;&lt; mydec.getPadColumn() &lt;&lt;  std::endl &lt;&lt;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <span class="stringliteral">&quot; ...........Exiting.........&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                  exit(0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            assert (K &gt; 0 &amp;&amp; K &lt; 31);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            UInt_t cell_i = mydec.getCellID();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="comment">//FIXME: What happens if we simulate a different number of</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="comment">//Modules than were actually connected</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="comment">//I think than we find nothing in the lookup table</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="comment">//I believe that a simple modif of the following function can remedy the</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="comment">//situation. At the moment it is ok that it throws a run time error</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="comment">//To be verified !!!!!!!!</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="comment">//CAMM: it&#39;s much faster to use already the value saved instead of recalculating it from scratch... the method _mapping.getModuleIndexFromCellIndex() is quite time consuming.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            UInt_t module_index = mydec.getModuleIndex();<span class="comment">//_mapping.getModuleIndexFromCellIndex(hit_raw-&gt;getCellID0());</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="preprocessor">#ifdef RECO_DEBUG</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor"></span>            std::cout &lt;&lt; <span class="stringliteral">&quot;Found module index: &quot;</span> &lt;&lt; module_index &lt;&lt; <span class="stringliteral">&quot; from cell: &quot;</span> &lt;&lt; std::hex &lt;&lt; hit_raw-&gt;getCellID0() &lt;&lt; std::dec &lt;&lt; std::endl;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor"></span>            <span class="comment">//CRP The check on a valid module index has to be revised</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="comment">//assert (module_index &gt;= _mapping.getNModules());</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            UInt_t module_id = mydec.getModuleID();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            UInt_t module_type = mydec.getModuleType();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            UInt_t isBad = mydec.isBad();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            assert (cell_i &lt; 324);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            UInt_t layer = 0;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            UInt_t cell=0;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">//CRP Rearrange for the tme being to be save for</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="comment">//data -&gt; to be verified for MC!!!!!</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="comment">//CAMM: OK for MC!</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            UInt_t access_parameter;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">if</span> (!_runInfo.isMC()) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;              access_parameter = module_index;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;              cell = cell_i;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;              layer = K-1;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;              access_parameter = layer;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;              cell = 36*(3*(mydec.getWaferColumn()-1)+mydec.getWaferRow()-1)+6*(mydec.getPadColumn()-1)+mydec.getPadRow()-1;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              assert (layer &gt;= 0);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;              assert (layer &lt; 30);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;              assert (cell &gt;= 0);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;              assert (cell &lt; 324);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="comment">//If at all</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <a class="code" href="classCALICE_1_1NoiseParameter.html">NoiseParameter</a> &amp;cell_parameter=noiseArray[access_parameter][cell];</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            Float_t noise = cell_parameter.<a class="code" href="classCALICE_1_1NoiseParameter.html#a25c5efb36b96a6d55f475d7721585d87">getNoise</a>();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="comment">// buffer the calibrated value, to avoid a recalculation</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            Float_t raw_value = 0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordflow">if</span> (!_runInfo.isMC()) raw_value = static_cast&lt;float&gt;(hit_raw-&gt;getAmplitude())/10000.;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">else</span> raw_value = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(hit_raw-&gt;getAmplitude());</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="comment">//std::cout &lt;&lt; &quot; Hit : &quot; &lt;&lt; ele &lt;&lt; &quot;, module_id = &quot; &lt;&lt; module_id &lt;&lt; &quot;, module_type = &quot; &lt;&lt; module_type &lt;&lt; &quot;, cell_i = &quot; &lt;&lt; cell_i &lt;&lt; &quot;, layer &quot; &lt;&lt; K &lt;&lt; &quot; S,M,I,J : &quot; &lt;&lt; mydec.getWaferRow()&lt;&lt;&quot;,&quot;&lt;&lt;mydec.getWaferColumn()&lt;&lt;&quot;,&quot;&lt;&lt;mydec.getPadRow()&lt;&lt;&quot;,&quot;&lt;&lt;mydec.getPadColumn() &lt;&lt; &quot; ==&gt; raw value = &quot; &lt;&lt; raw_value &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            Float_t calibrated_value = 0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">if</span> (((_runInfo.isMC() &amp;&amp; !cell_parameter.<a class="code" href="classCALICE_1_1NoiseParameter.html#aaad737204e2573e3fb934bb9ef373107">isDead</a>()) || !_runInfo.isMC()) &amp;&amp; isBad == 0) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;              calibrated_value = _calibration-&gt;<a class="code" href="classCalibration.html#aca88d93a445ba3021c05dd61b293568c">getCalibratedValue</a>(module_id,module_type,cell_i,raw_value);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_runInfo.isMC()) calibrated_value = 1./50*raw_value; <span class="comment">//dummy value for the MC layers.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">if</span> (raw_value&gt;minAdcSignalThreshold &amp;&amp; raw_value&gt;noise*<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a457ab672e3467ed409a58e42e4aa6229">_noiseCut</a> &amp;&amp; calibrated_value&gt;<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">_signalThreshold</a>)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;              {<span class="comment">// -- signal</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor">#ifdef RECO_DEBUG</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor"></span>                <span class="comment">//CRP 25/11/15 some sanity checks</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">if</span>(cell_parameter.<a class="code" href="classCALICE_1_1NoiseParameter.html#aaad737204e2573e3fb934bb9ef373107">isDead</a>()) { </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;is dead: ?&quot;</span> &lt;&lt; cell_parameter.<a class="code" href="classCALICE_1_1NoiseParameter.html#aaad737204e2573e3fb934bb9ef373107">isDead</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;is Bad: ?&quot;</span> &lt;&lt; isBad &lt;&lt; std::endl;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;Noise: &quot;</span> &lt;&lt;  noise&lt;&lt; std::endl; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;Raw value: &quot;</span> &lt;&lt; raw_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;Calibrated value: &quot;</span> &lt;&lt; calibrated_value &lt;&lt; std::endl;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;Check cell: &quot;</span> &lt;&lt; cell_i &lt;&lt; std::endl;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;CellID0 = &quot;</span> &lt;&lt; std::hex &lt;&lt; hit_raw-&gt;getCellID0() &lt;&lt; std::endl &lt;&lt;<span class="stringliteral">&quot; CellID1 = &quot;</span> &lt;&lt; hit_raw-&gt;getCellID1() &lt;&lt; std::dec &lt;&lt; std::endl;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                  std::cout &lt;&lt; <span class="stringliteral">&quot;Check dead cells: &quot;</span> &lt;&lt; mydec.getLayerIndex() &lt;&lt; <span class="stringliteral">&quot;, M=&quot;</span> &lt;&lt; mydec.getWaferRow() &lt;&lt; <span class="stringliteral">&quot;, S=&quot;</span> &lt;&lt; mydec.getWaferColumn() &lt;&lt; <span class="stringliteral">&quot;, I=&quot;</span> &lt;&lt; mydec.getPadRow() &lt;&lt; <span class="stringliteral">&quot;, J=&quot;</span> &lt;&lt; mydec.getPadColumn() &lt;&lt; <span class="stringliteral">&quot;, type=&quot;</span> &lt;&lt; mydec.getModuleType() &lt;&lt; <span class="stringliteral">&quot;, ID=&quot;</span> &lt;&lt; mydec.getModuleID() &lt;&lt; <span class="stringliteral">&quot;, index=&quot;</span> &lt;&lt; mydec.getModuleIndex() &lt;&lt; <span class="stringliteral">&quot;, cell=&quot;</span> &lt;&lt; mydec.getCellID() &lt;&lt; <span class="stringliteral">&quot;, isBad=&quot;</span> &lt;&lt; mydec.isBad() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                } </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor"></span>                IMPL::CalorimeterHitImpl *hit=<span class="keyword">new</span> IMPL::CalorimeterHitImpl;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                hit-&gt;setCellID0(hit_raw-&gt;getCellID0());</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                hit-&gt;setCellID1(hit_raw-&gt;getCellID1());</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                hit-&gt;setTime(hit_raw-&gt;getTimeStamp());</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                hit-&gt;setEnergy( calibrated_value );</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="comment">//FIXME: create a table in the database for the MC with the position of ALL cells saved, instead of using the data mapping...</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="keywordflow">if</span> (!_runInfo.isMC()){</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                  hit-&gt;setPosition(_mapping.getPosition(module_index,cell_i).data());</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <span class="keywordflow">else</span> {<span class="comment">//if MC</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                  <span class="comment">//if (!cell_parameter.isDead()) hit-&gt;setPosition(_mapping.getPosition(module_index,cell_i).data());</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                  <span class="keywordtype">float</span> pos[3] = {0,0,0};</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                  <span class="keywordflow">if</span> ((hit_raw-&gt;getCellID0()&amp;0x80000000)  == 0) {<span class="comment">//signal hit</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                    <span class="comment">//set the link to the initial simhit</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    <span class="keywordflow">if</span>(col_RawToSim) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rela = 0; rela &lt; col_RawToSim-&gt;getNumberOfElements(); rela++){</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        <span class="keyword">const</span> LCRelation* rel = (<span class="keyword">const</span> LCRelation*)col_RawToSim-&gt;getElementAt(rela) ;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        <span class="keywordflow">if</span> (((RawCalorimeterHit*)rel-&gt;getFrom())-&gt;getCellID0() == hit_raw-&gt;getCellID0()){</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                          assert ((SimCalorimeterHit*)rel-&gt;getTo() != NULL);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                          hit-&gt;setRawHit((SimCalorimeterHit*)rel-&gt;getTo());</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                          pos[0] = ((SimCalorimeterHit*)rel-&gt;getTo())-&gt;getPosition()[0];</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                          pos[1] = ((SimCalorimeterHit*)rel-&gt;getTo())-&gt;getPosition()[1];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                          pos[2] = ((SimCalorimeterHit*)rel-&gt;getTo())-&gt;getPosition()[2];</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                      }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    } <span class="keywordflow">else</span> std::cout &lt;&lt; <span class="stringliteral">&quot;Signal hit but no relation to simhit???? &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                  }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                  <span class="keywordflow">if</span> (isBad == 0) hit-&gt;setPosition(_mapping.getPosition(module_index,cell_i).data());</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                  <span class="keywordflow">else</span> { </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                    <span class="comment">//If this cell has a valid module index then fill the positions from the mapping</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    <span class="keywordflow">if</span> (_mapping.isValid(module_index)) hit-&gt;setPosition(_mapping.getPosition(module_index,cell_i).data());</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                      <span class="comment">//CRP 26/11/15 We have now here a cell that was flagged bad somewhere upstream,</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                      <span class="comment">//maybe because it was physically not there inthe experimental setup but still</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                      <span class="comment">//got simulated. Early CALICE convention to simulate everything</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                      <span class="comment">//This happens for DESY 2005 and CERN 2006/2007  </span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                      <span class="comment">//Since the CellID1 has no more any bit free to signal this we choose to modify the Mokka x,y-positions</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                      <span class="comment">//such that for all God&#39;s sake these cells can be easily spotted by the analyser </span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                      <span class="keywordtype">float</span> pos_fallback[3] = {0,0,0};</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                      pos_fallback[0] = pos[0] - _fallbackShift;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                      pos_fallback[1] = pos[1] - _fallbackShift;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                      pos_fallback[2] = pos[2] - _fallbackShift;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                      hit-&gt;setPosition(pos_fallback);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">#ifdef RECO_DEBUG</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor"></span>                      std::cout &lt;&lt;<span class="stringliteral">&quot;CALICE::CalibrateAndApplyThreshold: Warning fallback shift needed: &quot;</span> &lt;&lt; std::endl; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor"></span>                    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                  }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                  </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                  </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                  <span class="keywordflow">if</span> (col_RawToSim) {<span class="comment">//kkk links hit to simhit</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                       LCRelationNavigator nav_RawToSim(col_RawToSim);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                       <span class="keyword">const</span> LCObjectVec &amp; vec_hit_sim = nav_RawToSim.getRelatedToObjects(hit_raw);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                       <span class="keywordflow">if</span> (vec_hit_sim.size() == 1) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                            SimCalorimeterHit * hit_sim = <span class="keyword">dynamic_cast&lt;</span>SimCalorimeterHit*<span class="keyword">&gt;</span>(vec_hit_sim[0]);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                            nav_RecToSim.addRelation(hit, hit_sim);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vec_hit_sim.size() &gt; 1) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            cout &lt;&lt; <span class="stringliteral">&quot;ERROR vec_hit_sim.size() = &quot;</span> &lt;&lt; vec_hit_sim.size() &lt;&lt; endl;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                       } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                            <span class="comment">/* kkk: There is no linked simulated hit.            */</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                            <span class="comment">/* This happens.                                     */</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                            <span class="comment">/* Probably noise hits have been added by digitizer. */</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                            ;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                  } <span class="keywordflow">else</span> { </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#ifdef RECO_DEBUG</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor"></span>                   std::cout &lt;&lt; <span class="stringliteral">&quot;Missing raw to sim relation &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="preprocessor"></span>                  } </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                }<span class="comment">//if MC</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                col_hit-&gt;addElement(hit);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#ifdef EXPORT_SIGNAL_TO_NOISE_RATIO</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor"></span>                <span class="keywordflow">if</span> (noise !=0) signal_over_noise_ratio.push_back(raw_value/noise);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor"></span>              }<span class="comment">//signal</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordflow">else</span> {<span class="comment">//noise</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          }<span class="comment">//loop on raw hits</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="preprocessor">#ifdef EXPORT_SIGNAL_TO_NOISE_RATIO</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span> (col_hit-&gt;getNumberOfElements()&gt;0) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="keywordflow">if</span> (!signal_over_noise_ratio.empty()) col_hit-&gt;parameters().setValues(std::string(<span class="stringliteral">&quot;SN&quot;</span>),signal_over_noise_ratio);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor"></span>          evtP-&gt;addCollection(col_hit,<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a10dd53b4f7d1514791ec6c60329aaea4">_hitColName</a>);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          <span class="comment">//}</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="comment">//else {</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          <span class="comment">//delete col_hit;</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;          <span class="comment">//}</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#aba8a11b61c43b9339e3140839fc5b213">_linkRecToSim</a>) evtP-&gt;addCollection(nav_RecToSim.createLCCollection(), <a class="code" href="classCALICE_1_1CalibrateAndApplyThreshold.html#a6ba0e8c707c10c6ace7b034293d34035">_RecToSimColName</a>);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      }<span class="comment">//if input col</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }<span class="comment">//try</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">catch</span> ( DataNotAvailableException &amp;err ){</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      streamlog_out(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Counting failing events: &quot;</span> &lt;&lt; endl; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      _nEventsWithoutRAWHITS++;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">//CRP Suppressed firstEvent variable</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">//firstEvent = false;</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    _nEvt++;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  }<span class="comment">//processEvt</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordtype">void</span> CalibrateAndApplyThreshold::end() {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot; Processor &quot;</span> &lt;&lt; name() &lt;&lt; <span class="stringliteral">&quot; summary : &quot;</span> &lt;&lt; endl &lt;&lt;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="stringliteral">&quot;---&gt; dropped &quot;</span> &lt;&lt; _nEventsWithoutRAWHITS &lt;&lt; <span class="stringliteral">&quot; events without RAW hits,&quot;</span> &lt;&lt; endl &lt;&lt;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="stringliteral">&quot;---&gt; found &quot;</span> &lt;&lt; _nEventsWithoutSIMHITS &lt;&lt; <span class="stringliteral">&quot; events without SIM hits,&quot;</span> &lt;&lt; endl &lt;&lt;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="stringliteral">&quot;---&gt; Total events processed : &quot;</span> &lt;&lt; _nEvt &lt;&lt; std::endl;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}<span class="comment">//namespace CALICE</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="ttc" id="classCalibration_html_aca88d93a445ba3021c05dd61b293568c"><div class="ttname"><a href="classCalibration.html#aca88d93a445ba3021c05dd61b293568c">Calibration::getCalibratedValue</a></div><div class="ttdeci">virtual Float_t getCalibratedValue(UInt_t module_id, UInt_t module_type, UInt_t cell_index, Float_t adc_value) const =0</div><div class="ttdoc">Determine from a pedestal subtracted ADC value a calibrated value. </div></div>
<div class="ttc" id="classCALICE_1_1NoiseParameter_html_aaad737204e2573e3fb934bb9ef373107"><div class="ttname"><a href="classCALICE_1_1NoiseParameter.html#aaad737204e2573e3fb934bb9ef373107">CALICE::NoiseParameter::isDead</a></div><div class="ttdeci">short isDead() const </div><div class="ttdoc">Return kTRUE if the pad is considered to be dead. </div><div class="ttdef"><b>Definition:</b> <a href="NoiseParameter_8cc_source.html#l00152">NoiseParameter.cc:152</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a457ab672e3467ed409a58e42e4aa6229"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a457ab672e3467ed409a58e42e4aa6229">CALICE::CalibrateAndApplyThreshold::_noiseCut</a></div><div class="ttdeci">Float_t _noiseCut</div><div class="ttdoc">will be set by the first element of the _noiseCutVec </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00090">CalibrateAndApplyThreshold.hh:90</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a10dd53b4f7d1514791ec6c60329aaea4"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a10dd53b4f7d1514791ec6c60329aaea4">CALICE::CalibrateAndApplyThreshold::_hitColName</a></div><div class="ttdeci">std::string _hitColName</div><div class="ttdoc">Name of the hit collection (OUTPUT). </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00093">CalibrateAndApplyThreshold.hh:93</a></div></div>
<div class="ttc" id="classCALICE_1_1NoiseParameter_html"><div class="ttname"><a href="classCALICE_1_1NoiseParameter.html">CALICE::NoiseParameter</a></div><div class="ttdoc">Information about a pad: Pedestal, noise, etc. </div><div class="ttdef"><b>Definition:</b> <a href="NoiseParameter_8hh_source.html#l00012">NoiseParameter.hh:12</a></div></div>
<div class="ttc" id="classNoOpCalibration_html"><div class="ttname"><a href="classNoOpCalibration.html">NoOpCalibration</a></div><div class="ttdoc">Lazy calibration class. </div><div class="ttdef"><b>Definition:</b> <a href="NoOpCalibration_8hh_source.html#l00010">NoOpCalibration.hh:10</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a36efa661235242659c74a49235164662"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a36efa661235242659c74a49235164662">CALICE::CalibrateAndApplyThreshold::_calibrationObjectName</a></div><div class="ttdeci">std::string _calibrationObjectName</div><div class="ttdoc">Name of the Calibration object to be used (will be created using the CalibrationFactory) ...</div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00099">CalibrateAndApplyThreshold.hh:99</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a3e6c0435de64d50ae08374cf145c8c8b"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3e6c0435de64d50ae08374cf145c8c8b">CALICE::CalibrateAndApplyThreshold::_colNameReferenceTransformation</a></div><div class="ttdeci">std::string _colNameReferenceTransformation</div><div class="ttdoc">Name of the conditions data collection which describes the reference position and rotation...</div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00126">CalibrateAndApplyThreshold.hh:126</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a6ba0e8c707c10c6ace7b034293d34035"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a6ba0e8c707c10c6ace7b034293d34035">CALICE::CalibrateAndApplyThreshold::_RecToSimColName</a></div><div class="ttdeci">std::string _RecToSimColName</div><div class="ttdoc">kkk: Name of the relation collection hit -&amp;gt; simhit (OUTPUT). </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00096">CalibrateAndApplyThreshold.hh:96</a></div></div>
<div class="ttc" id="classCalibrationFactory_html_a8ec8e4dacbc4b38c7fd760b7b00857d3"><div class="ttname"><a href="classCalibrationFactory.html#a8ec8e4dacbc4b38c7fd760b7b00857d3">CalibrationFactory::listKits</a></div><div class="ttdeci">void listKits()</div><div class="ttdoc">Show all registered kits. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrationFactory_8cc_source.html#l00006">CalibrationFactory.cc:6</a></div></div>
<div class="ttc" id="classLCPayload_html"><div class="ttname"><a href="classLCPayload.html">LCPayload</a></div><div class="ttdoc">Specific LCIO implementation of the interface to store generic user data. </div><div class="ttdef"><b>Definition:</b> <a href="LCPayload_8hh_source.html#l00019">LCPayload.hh:19</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a1e6bdda0ecedd7a21053f54f178478b1"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a1e6bdda0ecedd7a21053f54f178478b1">CALICE::CalibrateAndApplyThreshold::_referenceTransformationChange</a></div><div class="ttdeci">ConditionsChangeDelegator&lt; CalibrateAndApplyThreshold &gt; _referenceTransformationChange</div><div class="ttdoc">helper class to listen for changes of the reference position or rotation. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00133">CalibrateAndApplyThreshold.hh:133</a></div></div>
<div class="ttc" id="classCALICE_1_1ErrorMissingConditionsDataHandler_html"><div class="ttname"><a href="classCALICE_1_1ErrorMissingConditionsDataHandler.html">CALICE::ErrorMissingConditionsDataHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="BaseMappingIIProcessor_8hh_source.html#l00019">BaseMappingIIProcessor.hh:19</a></div></div>
<div class="ttc" id="classCALICE_1_1VRawADCValueProcessor_html_a7c7446a4e691d62dbeaaf09d64122af0"><div class="ttname"><a href="classCALICE_1_1VRawADCValueProcessor.html#a7c7446a4e691d62dbeaaf09d64122af0">CALICE::VRawADCValueProcessor::_colNameModuleDescription</a></div><div class="ttdeci">std::string _colNameModuleDescription</div><div class="ttdoc">Name of the conditions data collection containing module descriptions. </div><div class="ttdef"><b>Definition:</b> <a href="VRawADCValueProcessor_8hh_source.html#l00031">VRawADCValueProcessor.hh:31</a></div></div>
<div class="ttc" id="classCALICE_1_1NoiseParameter_html_a25c5efb36b96a6d55f475d7721585d87"><div class="ttname"><a href="classCALICE_1_1NoiseParameter.html#a25c5efb36b96a6d55f475d7721585d87">CALICE::NoiseParameter::getNoise</a></div><div class="ttdeci">double getNoise() const </div><div class="ttdoc">Get the noise. </div><div class="ttdef"><b>Definition:</b> <a href="NoiseParameter_8cc_source.html#l00139">NoiseParameter.cc:139</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a3a6f0a6d75fa972ac6303604bb515fc7"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3a6f0a6d75fa972ac6303604bb515fc7">CALICE::CalibrateAndApplyThreshold::_rawhitColName</a></div><div class="ttdeci">std::string _rawhitColName</div><div class="ttdoc">Name of the hit collection (INPUT). </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00092">CalibrateAndApplyThreshold.hh:92</a></div></div>
<div class="ttc" id="classCALICE_1_1VRawADCValueProcessor_html"><div class="ttname"><a href="classCALICE_1_1VRawADCValueProcessor.html">CALICE::VRawADCValueProcessor</a></div><div class="ttdoc">Abstract class which implements the minimal functionality to access raw ADC values. </div><div class="ttdef"><b>Definition:</b> <a href="VRawADCValueProcessor_8hh_source.html#l00018">VRawADCValueProcessor.hh:18</a></div></div>
<div class="ttc" id="classCalibrationFactory_html_a5efb95a0d951b8da5a8bdb5832a9831d"><div class="ttname"><a href="classCalibrationFactory.html#a5efb95a0d951b8da5a8bdb5832a9831d">CalibrationFactory::getInstance</a></div><div class="ttdeci">static CalibrationFactory * getInstance()</div><div class="ttdoc">Get the global instance of the Calibration Object Factory. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrationFactory_8hh_source.html#l00028">CalibrationFactory.hh:28</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a9f46c5087b5975ec06c36e9da4f33378"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a9f46c5087b5975ec06c36e9da4f33378">CALICE::CalibrateAndApplyThreshold::_detectorTransformationChange</a></div><div class="ttdeci">ConditionsChangeDelegator&lt; CalibrateAndApplyThreshold &gt; _detectorTransformationChange</div><div class="ttdoc">helper class to listen for changes of the detector position or rotation. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00130">CalibrateAndApplyThreshold.hh:130</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a2c3e34db11fe08fab2b184cc87f4d7b5"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a2c3e34db11fe08fab2b184cc87f4d7b5">CALICE::CalibrateAndApplyThreshold::processEvent</a></div><div class="ttdeci">void processEvent(LCEvent *evtP)</div><div class="ttdoc">Reconstruct calorimeter hits. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8cc_source.html#l00247">CalibrateAndApplyThreshold.cc:247</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a1318d9f3f1a695b1996c30c63c47d085"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a1318d9f3f1a695b1996c30c63c47d085">CALICE::CalibrateAndApplyThreshold::~CalibrateAndApplyThreshold</a></div><div class="ttdeci">~CalibrateAndApplyThreshold()</div><div class="ttdoc">destructor. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8cc_source.html#l00138">CalibrateAndApplyThreshold.cc:138</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a3bd3d21d979363fa105e7cea54148502"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a3bd3d21d979363fa105e7cea54148502">CALICE::CalibrateAndApplyThreshold::processRunHeader</a></div><div class="ttdeci">void processRunHeader(LCRunHeader *run)</div><div class="ttdoc">Called for every run (does nothing.) </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8cc_source.html#l00217">CalibrateAndApplyThreshold.cc:217</a></div></div>
<div class="ttc" id="classCalibration_html_a7d516d7b66b1f20640829d12adfd64d6"><div class="ttname"><a href="classCalibration.html#a7d516d7b66b1f20640829d12adfd64d6">Calibration::isValid</a></div><div class="ttdeci">virtual Bool_t isValid(UInt_t module_id, UInt_t module_type, UInt_t cell_index) const </div><div class="ttdoc">Return true if a the calibration constants for the given cell are in the allowed range. </div><div class="ttdef"><b>Definition:</b> <a href="Calibration_8hh_source.html#l00031">Calibration.hh:31</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a79e5cf6fc879e14cdd3c68f88b1ff7c1"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a79e5cf6fc879e14cdd3c68f88b1ff7c1">CALICE::CalibrateAndApplyThreshold::_calibrationConstantColName</a></div><div class="ttdeci">std::string _calibrationConstantColName</div><div class="ttdoc">Name of the conditions data collection containing the calibration constants. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00100">CalibrateAndApplyThreshold.hh:100</a></div></div>
<div class="ttc" id="classSimpleArray__t_html"><div class="ttname"><a href="classSimpleArray__t.html">SimpleArray_t</a></div><div class="ttdoc">Wrapper around std::vector which adds optional boundary check (at compile time). </div><div class="ttdef"><b>Definition:</b> <a href="SimpleArray__t_8hh_source.html#l00019">SimpleArray_t.hh:19</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html">CALICE::CalibrateAndApplyThreshold</a></div><div class="ttdoc">Marlin Processor to go from RawCalorimeterHit to calibrated CalorimeterHits. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00036">CalibrateAndApplyThreshold.hh:36</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a7c318b024c59652ac1989c8c1486aa49"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a7c318b024c59652ac1989c8c1486aa49">CALICE::CalibrateAndApplyThreshold::_signalThreshold</a></div><div class="ttdeci">Float_t _signalThreshold</div><div class="ttdoc">Signals above the signal threshold and ... </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00086">CalibrateAndApplyThreshold.hh:86</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_adfacf11438d8b5f863f6e77722dc5e20"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#adfacf11438d8b5f863f6e77722dc5e20">CALICE::CalibrateAndApplyThreshold::_noiseCutVec</a></div><div class="ttdeci">FloatVec _noiseCutVec</div><div class="ttdoc">above the noise cut are considered to be hits. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00087">CalibrateAndApplyThreshold.hh:87</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a4a6e48e29b530ac9b80375776cd4af31"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a4a6e48e29b530ac9b80375776cd4af31">CALICE::CalibrateAndApplyThreshold::_colNameDetectorTransformation</a></div><div class="ttdeci">std::string _colNameDetectorTransformation</div><div class="ttdoc">Name of the conditions data collection which describes the position and the rotation of the detector...</div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00124">CalibrateAndApplyThreshold.hh:124</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_aba8a11b61c43b9339e3140839fc5b213"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#aba8a11b61c43b9339e3140839fc5b213">CALICE::CalibrateAndApplyThreshold::_linkRecToSim</a></div><div class="ttdeci">bool _linkRecToSim</div><div class="ttdoc">kkk flag to disable/enable the creation of an LCRelation to simulated hit </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00095">CalibrateAndApplyThreshold.hh:95</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a69d43c0be2a238e99828c918003bde74"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a69d43c0be2a238e99828c918003bde74">CALICE::CalibrateAndApplyThreshold::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">Called at the begin of the job before anything is read. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8cc_source.html#l00142">CalibrateAndApplyThreshold.cc:142</a></div></div>
<div class="ttc" id="classCalibration_html_a4e45f1eca0d4fdf19ad76b8f581aee12"><div class="ttname"><a href="classCalibration.html#a4e45f1eca0d4fdf19ad76b8f581aee12">Calibration::getMiniumADCForMipThreshold</a></div><div class="ttdeci">virtual Int_t getMiniumADCForMipThreshold(Float_t mip_energy_fraction) const =0</div><div class="ttdoc">Get the minimum adc value mips will have for the given energy fraction on all pads. </div></div>
<div class="ttc" id="classCalibrationFactory_html_a1682bde6eef1a7ff023421abc8bf4534"><div class="ttname"><a href="classCalibrationFactory.html#a1682bde6eef1a7ff023421abc8bf4534">CalibrationFactory::createCalibrationObject</a></div><div class="ttdeci">Calibration * createCalibrationObject(const std::string &amp;name, const std::string &amp;module_type_col_name, const std::string &amp;module_calibration_col_name) noexcept(false)</div><div class="ttdoc">Get an object for the calibration. </div><div class="ttdef"><b>Definition:</b> <a href="CalibrationFactory_8hh_source.html#l00045">CalibrationFactory.hh:45</a></div></div>
<div class="ttc" id="classCALICE_1_1CalibrateAndApplyThreshold_html_a75f2b80baf0f8691c9d921d70bafb649"><div class="ttname"><a href="classCALICE_1_1CalibrateAndApplyThreshold.html#a75f2b80baf0f8691c9d921d70bafb649">CALICE::CalibrateAndApplyThreshold::_RawToSimColName</a></div><div class="ttdeci">std::string _RawToSimColName</div><div class="ttdoc">Name of the relation collection between Sim and Raw hits (INPUT). </div><div class="ttdef"><b>Definition:</b> <a href="CalibrateAndApplyThreshold_8hh_source.html#l00097">CalibrateAndApplyThreshold.hh:97</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
